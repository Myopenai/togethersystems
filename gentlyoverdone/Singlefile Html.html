<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GentlyOverdone Â· Oneâ€‘file Demo</title>
  <style>body{margin:0;background:#0c0d11;color:#e7e7ec;font:14px/1.5 Inter,system-ui,Arial}</style>
</head>
<body>
  <h1 style="padding:12px">GentlyOverdone Â· Oneâ€‘file Demo</h1>
  <script>
  /* GentlyOverdone Â· Allâ€‘inâ€‘One Embed <script> (DE/NL/EN, offline/online, Icecast/HLS/WebRTC, Visuals)
Config via data-attrs on <script>:
 data-lang="auto|de|nl|en" data-theme="auto|dark|light" data-title="GentlyOverdone" data-artist="TEL"
 data-accent="#8AF3FF" data-icecast="https://example.com:8000/stream.mp3"
 data-hls="https://cdn.example.com/hls/stream.m3u8" data-whep="https://webrtc.example.com/whep/stream-id"
 data-offline="true|false" data-allowshare="true|false"
Legal: Ensure streaming rights (BUMA/STEMRA/GEMA etc). Use HTTPS for HLS/WebRTC. Autoplay may need user interaction.
*/!function(){"use strict";const $S=document.currentScript,$D=(a,b)=>($S&&$S.dataset&&$S.dataset[a])||b,CFG={lang:($D("lang","auto")||"auto").toLowerCase(),theme:($D("theme","auto")||"auto").toLowerCase(),title:$D("title","GentlyOverdone"),artist:$D("artist","TEL"),accent:$D("accent","#8AF3FF"),ice:$D("icecast",""),hls:$D("hls",""),whep:$D("whep",""),offline:(($D("offline","true")||"true").toString().toLowerCase()==="true"),share:(($D("allowshare","true")||"true").toString().toLowerCase()==="true")};const L=(()=>{const T=(n)=>n.toLowerCase().startsWith("de")?"de":n.toLowerCase().startsWith("nl")?"nl":"en";const pick=CFG.lang==="auto"?T(navigator.language||"en"):CFG.lang;const t={de:{live:"Live",lowlat:"Niedrige Latenz",startSynth:"Synth aktivieren",holdDrone:"Drone halten",gain:"Lautst.",freq:"Frequ.",status:"Status",stable:"Stabil",traffic:"Traffic",alerts:"Warnungen",source:"Quelle",type:"Typ",webrtc:"WebRTC (WHEP)",hls:"HLS",icecast:"Icecast/MP3",offline:"Offlineâ€‘Demo",connect:"Verbinden",stop:"Stopp",nowPlaying:"Jetzt lÃ¤uft",by:"von",share:"Einbinden/Teilen",copy:"Kopieren",copied:"Kopiert!",unmute:"Ton einschalten",muted:"Stumm",extensions:"Erweiterungen",websocket:"WebSocket",bridge:"Bridge",bci:"BCI",futuristic:"Futuristische I/O",title:CFG.title,artist:CFG.artist},nl:{live:"Live",lowlat:"Lage latentie",startSynth:"Synth activeren",holdDrone:"Drone vasthouden",gain:"Volume",freq:"Frequentie",status:"Status",stable:"Stabiel",traffic:"Verkeer",alerts:"Waarschuwingen",source:"Bron",type:"Type",webrtc:"WebRTC (WHEP)",hls:"HLS",icecast:"Icecast/MP3",offline:"Offline demo",connect:"Verbinden",stop:"Stop",nowPlaying:"Speelt nu",by:"door",share:"Insluiten/Deel",copy:"KopiÃ«ren",copied:"Gekopieerd!",unmute:"Geluid aan",muted:"Gedempt",extensions:"Uitbreidingen",websocket:"WebSocket",bridge:"Bridge",bci:"BCI",futuristic:"Futuristische I/O",title:CFG.title,artist:CFG.artist},en:{live:"Live",lowlat:"Low latency",startSynth:"Enable synth",holdDrone:"Hold drone",gain:"Gain",freq:"Freq",status:"Status",stable:"Stable",traffic:"Traffic",alerts:"Alerts",source:"Source",type:"Type",webrtc:"WebRTC (WHEP)",hls:"HLS",icecast:"Icecast/MP3",offline:"Offline demo",connect:"Connect",stop:"Stop",nowPlaying:"Now playing",by:"by",share:"Embed/Share",copy:"Copy",copied:"Copied!",unmute:"Unmute",muted:"Muted",extensions:"Extensions",websocket:"WebSocket",bridge:"Bridge",bci:"BCI",futuristic:"Futuristic I/O",title:CFG.title,artist:CFG.artist}};return t[pick]})();const host=document.createElement("div"),root=(host.attachShadow?host.attachShadow({mode:"open"}):host);($S&&$S.parentNode?$S.parentNode:document.body).insertBefore(host,$S&&$S.nextSibling?$S.nextSibling:null);const css=`:host{all:initial}*,*:before,*:after{box-sizing:border-box}body{margin:0} .wrap{font:14px/1.5 Inter,system-ui,Arial,sans-serif;color:var(--fg);background:var(--bg);border-radius:14px;box-shadow:0 10px 30px #0003;overflow:hidden} .hdr{padding:16px 18px;background:linear-gradient(120deg,#0f0c29,#302b63,#24243e);color:#fff;display:flex;align-items:center;gap:10px;flex-wrap:wrap} .acc{color:var(--acc)} .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap} .btn{appearance:none;border:0;border-radius:12px;padding:8px 12px;background:#ffffff1a;color:inherit;cursor:pointer} .btn:focus{outline:none;box-shadow:0 0 0 2px var(--acc)} .grid{display:grid;gap:12px;padding:12px;grid-template-columns:1.2fr .8fr} .card{background:var(--card);border-radius:12px;padding:12px} .kpi{font-size:24px;font-weight:700} .muted{opacity:.75} .badge{font-size:11px;border:1px solid #ffffff26;border-radius:999px;padding:2px 8px} .sl{display:flex;gap:6px;align-items:center} canvas{display:block;width:100%;height:160px;background:#0e1020;border-radius:10px} .share{margin-top:10px} .inp{width:100%;padding:8px;border-radius:8px;border:1px solid #ffffff26;background:#00000018;color:inherit} .small{font-size:12px;opacity:.8} .a{color:var(--acc);text-decoration:none} .col{display:flex;gap:10px;align-items:center} .r{display:flex;gap:8px;align-items:center} .pad{display:flex;gap:8px;align-items:center;flex-wrap:wrap} .rng{width:120px} .extensions{margin-top:12px;padding:12px;background:var(--card);border-radius:8px;border:1px solid #ffffff26} .ext-title{font-weight:600;margin-bottom:8px;color:var(--acc)} .ext-item{margin:4px 0;font-size:12px;opacity:.8}`;const style=document.createElement("style");const theme=(()=>{const prefers=matchMedia&&matchMedia('(prefers-color-scheme: light)').matches?"light":"dark";const t=CFG.theme==="auto"?prefers:CFG.theme;return t})();style.textContent=`:host{--bg:${theme==="light"?"#f6f7fb":"#0c0d11"};--fg:${theme==="light"?"#0e1117":"#e7e7ec"};--card:${theme==="light"?"#ffffff":"#141622"};--acc:${CFG.accent}} ${css}`;root.appendChild(style);const box=document.createElement("div");box.className="wrap";box.innerHTML=`<div class="hdr"><div class="row"><strong>${L.title}</strong><span class="badge">${L.by} ${L.artist}</span><span class="badge">NL Â· DE Â· EN</span></div><div class="row"><button class="btn" id="mode">${theme==="light"?"ðŸŒž":"ðŸŒ™"}</button><button class="btn" id="unmute" style="background:#ff4444;color:#fff">ðŸ”‡ ${L.unmute}</button><span class="badge">${L.live}</span></div></div><div class="grid"><div class="card"><div class="col"><span class="badge">${L.status}</span><span class="badge acc">${L.stable}</span></div><div class="kpi">ðŸŸ¢</div><p class="muted small">Audio + Visuals laufen lokal im Widget. HTTPS empfohlen.</p><div class="pad"><button class="btn" id="synth">${L.startSynth}</button><span class="badge">${L.gain}</span><input class="rng" id="gain" type="range" min="0" max="1" step="0.01" value="0.2"/><span class="badge">${L.freq}</span><input class="rng" id="freq" type="range" min="80" max="880" step="1" value="220"/><button class="btn" id="hold">${L.holdDrone}</button></div><div class="pad"><span class="badge">${L.type}</span><select class="inp" id="stype"><option value="auto">Auto</option><option value="whep">${L.webrtc}</option><option value="hls">${L.hls}</option><option value="ice">${L.icecast}</option><option value="offline">${L.offline}</option></select><button class="btn" id="connect">${L.connect}</button><button class="btn" id="stop">${L.stop}</button></div><div class="sl"><span class="badge">${L.source}</span><input class="inp" id="src" placeholder="${CFG.whep||CFG.hls||CFG.ice||"URL"}"></div><p class="small muted" id="np">${L.nowPlaying} â€” ${L.title} ${L.by} ${L.artist}</p><div class="share" ${CFG.share?"":"style=display:none"}><div class="row"><span class="badge">${L.share}</span><button class="btn" id="cpy">${L.copy}</button><span class="muted small" id="cpyd">&nbsp;</span></div><input class="inp" id="embed" readonly></div><div class="extensions"><div class="ext-title">${L.extensions}</div><div class="ext-item">â€¢ ${L.websocket}/${L.bridge}: Custom live channels</div><div class="ext-item">â€¢ ${L.futuristic}: ${L.bci} placeholders</div></div></div><div class="card"><canvas id="viz" width="800" height="160"></canvas><audio id="audio" crossorigin="anonymous" controls muted autoplay style="width:100%;margin-top:8px"></audio><p class="small muted">${L.lowlat}: WebRTC/WHEP Â· Kompatibel: HLS, Icecast/MP3 Â· Offlineâ€‘Synth als Fallback.</p></div></div>`;root.appendChild(box);const el=(id)=>root.getElementById(id),audio=el("audio"),viz=el("viz"),ctx=viz.getContext("2d"),state={light:theme==="light",started:false,held:false,osc:null,gain:null,ac:null,analyser:null,pc:null,hls:null,src:"",muted:true,autoplayAttempted:false};el("mode").addEventListener("click",()=>{state.light=!state.light;style.textContent=`:host{--bg:${state.light?"#f6f7fb":"#0c0d11"};--fg:${state.light?"#0e1117":"#e7e7ec"};--card:${state.light?"#ffffff":"#141622"};--acc:${CFG.accent}} ${css}`;el("mode").textContent=state.light?"ðŸŒž":"ðŸŒ™"});const setEmbed=()=>{const tag=`<script src=\\\"${$S&&$S.src?$S.src:"/gently-embed.min.js"}\\\" data-lang=\\\"${CFG.lang}\\\" data-theme=\\\"auto\\\" data-title=\\\"${CFG.title}\\\" data-artist=\\\"${CFG.artist}\\\" data-accent=\\\"${CFG.accent}\\\" data-icecast=\\\"${CFG.ice}\\\" data-hls=\\\"${CFG.hls}\\\" data-whep=\\\"${CFG.whep}\\\" data-offline=\\\"${CFG.offline}\\\" data-allowshare=\\\"${CFG.share}\\\"><\\/script>`;el("embed").value=tag};CFG.share&&setEmbed();el("cpy").addEventListener("click",async()=>{try{await navigator.clipboard.writeText(el("embed").value);el("cpyd").textContent=L.copied;setTimeout(()=>el("cpyd").textContent="",1500)}catch(e){el("cpyd").textContent=e+""}});const A=new (window.AudioContext||window.webkitAudioContext)();state.ac=A;const G=A.createGain();G.connect(A.destination);G.gain.value=0.2;state.gain=G;const An=A.createAnalyser();An.fftSize=1024;const b=new Uint8Array(An.frequencyBinCount);state.analyser=An;const connectMedia=()=>{const s=A.createMediaElementSource(audio);s.connect(G);s.connect(An)};let mediaNodeConnected=false;audio.addEventListener("play",()=>{if(!mediaNodeConnected){connectMedia();mediaNodeConnected=true}});const draw=()=>{requestAnimationFrame(draw);ctx.clearRect(0,0,viz.width,viz.height);ctx.fillStyle="#0a0c18";ctx.fillRect(0,0,viz.width,viz.height);An.getByteFrequencyData(b);const W=viz.width,H=viz.height,n=b.length,barW=W/n*2.2;for(let i=0;i<n;i++){const v=b[i]/255,m=v*H;ctx.fillStyle=i%13?CFG.accent:"#fff";ctx.fillRect(i*barW,H-m,barW-1,m)};ctx.globalCompositeOperation="lighter";ctx.beginPath();ctx.strokeStyle="#fff8";ctx.lineWidth=1;for(let x=0;x<W;x+=4){const idx=((x/W)*n)|0;const y=H-(b[idx]/255)*(H-4)-2; if(x===0)ctx.moveTo(0,y); else ctx.lineTo(x,y)}ctx.stroke();ctx.globalCompositeOperation="source-over"};draw();const initSynth=()=>{if(state.started)return;state.started=true;el("synth").textContent="âœ…"};el("synth").addEventListener("click",async()=>{await A.resume();initSynth();state.osc=A.createOscillator();state.osc.type="sine";state.osc.frequency.value=parseFloat(el("freq").value);state.osc.connect(G)});el("hold").addEventListener("mousedown",()=>{if(state.osc&&!state.held){state.osc.start();state.held=true}});["mouseup","mouseleave"].forEach(ev=>el("hold").addEventListener(ev,()=>{if(state.osc&&state.held){try{state.osc.stop()}catch{}state.held=false;state.osc=A.createOscillator();state.osc.type="sine";state.osc.frequency.value=parseFloat(el("freq").value);state.osc.connect(G)}}));el("gain").addEventListener("input",()=>{G.gain.value=parseFloat(el("gain").value)});el("freq").addEventListener("input",()=>{if(state.osc)state.osc.frequency.value=parseFloat(el("freq").value)});const canHLSNative=()=>audio.canPlayType('application/vnd.apple.mpegurl');const loadHLS=async(url)=>{if(canHLSNative()){audio.src=url;return}try{const mod=await import("https://cdn.jsdelivr.net/npm/hls.js@latest"); if(mod&&mod.default&&mod.default.isSupported()){const H=new mod.default({lowLatencyMode:true});H.loadSource(url);H.attachMedia(audio);state.hls=H}else{audio.src=(CFG.ice||"")}}catch(e){audio.src=(CFG.ice||"")}};const stopAll=()=>{if(state.hls){try{state.hls.destroy()}catch{} state.hls=null} if(state.pc){try{state.pc.close()}catch{} state.pc=null} audio.pause();audio.removeAttribute("src");audio.load()};const connectWHEP=async(url)=>{await A.resume();stopAll();const pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});state.pc=pc;pc.ontrack=(ev)=>{audio.srcObject=ev.streams[0]};const offer=await pc.createOffer({offerToReceiveAudio:true}); await pc.setLocalDescription(offer); const res=await fetch(url,{method:"POST",headers:{"Content-Type":"application/sdp"},body:offer.sdp}); const ans=await res.text(); await pc.setRemoteDescription({type:"answer",sdp:ans})};const connectAuto=async()=>{const type=el("stype").value;let src=el("src").value.trim()||CFG.whep||CFG.hls||CFG.ice||"";state.src=src; if(type==="offline"||(!src && CFG.offline)){ audio.removeAttribute("src"); audio.srcObject=null; audio.pause(); return} if(type==="whep"||(!type||type==="auto"&&CFG.whep)){return connectWHEP(src||CFG.whep)} if(type==="hls"||(!type||type==="auto"&&CFG.hls)){stopAll(); await loadHLS(src||CFG.hls); audio.play(); return} if(type==="ice"||(!type||type==="auto"&&CFG.ice)){stopAll(); audio.src=src||CFG.ice; audio.play(); return} if(CFG.hls){await loadHLS(CFG.hls); audio.play()} else if(CFG.ice){audio.src=CFG.ice; audio.play()} else if(CFG.offline){} };el("connect").addEventListener("click",connectAuto);el("stop").addEventListener("click",()=>{stopAll()});if(CFG.whep||CFG.hls||CFG.ice){el("src").value=CFG.whep||CFG.hls||CFG.ice} if(!CFG.whep&&!CFG.hls&&!CFG.ice&&CFG.offline){el("stype").value="offline"} const resize=()=>{const r=host.getBoundingClientRect();viz.width=Math.max(600,Math.floor(r.width-32))}; new ResizeObserver(resize).observe(host);resize();const unmuteBtn=el("unmute");const toggleMute=()=>{state.muted=!state.muted;audio.muted=state.muted;if(state.muted){unmuteBtn.innerHTML=`ðŸ”‡ ${L.unmute}`;unmuteBtn.style.background="#ff4444"}else{unmuteBtn.innerHTML=`ðŸ”Š ${L.muted}`;unmuteBtn.style.background="#44ff44"}};unmuteBtn.addEventListener("click",toggleMute);const autoConnect=async()=>{if(state.autoplayAttempted)return;state.autoplayAttempted=true;try{await A.resume();if(CFG.whep){await connectWHEP(CFG.whep);audio.play()}else if(CFG.hls){await loadHLS(CFG.hls);audio.play()}else if(CFG.ice){audio.src=CFG.ice;audio.play()}else if(CFG.offline){initSynth();state.osc=A.createOscillator();state.osc.type="sine";state.osc.frequency.value=220;state.osc.connect(G);state.osc.start()}}catch(e){console.log("Autoplay failed:",e)}};setTimeout(autoConnect,100);}();
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TELBANK â€“ Negative Assets Pool | TogetherSystems</title>
  <style>
    :root {
      --bg: #050816;
      --bg-alt: #0f172a;
      --card: #020617;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.12);
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: #1f2937;
      --radius: 18px;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.55);
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top, #0b1120 0, #020617 45%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 32px 16px;
    }
    .glow-orbit {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0.55;
      mix-blend-mode: screen;
      background:
        radial-gradient(circle at 10% 0%, rgba(56, 189, 248, 0.20) 0, transparent 50%),
        radial-gradient(circle at 90% 10%, rgba(59, 130, 246, 0.2) 0, transparent 55%),
        radial-gradient(circle at 50% 70%, rgba(147, 51, 234, 0.18) 0, transparent 60%);
      z-index: 0;
    }
    .app-shell {
      position: relative;
      z-index: 1;
      max-width: 1400px;
      margin: 0 auto;
    }
    header {
      margin-bottom: 32px;
    }
    h1 {
      font-size: clamp(2rem, 4vw, 3rem);
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .badge {
      font-size: 0.75rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.25), transparent);
      color: var(--muted);
    }
    .subtitle {
      color: var(--muted);
      font-size: 1rem;
      max-width: 800px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }
    .stat-card {
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.96));
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.15);
      backdrop-filter: blur(18px);
    }
    .stat-label {
      font-size: 0.75rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 8px;
    }
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent);
    }
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    .tab {
      padding: 10px 20px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.95);
      color: var(--muted);
      cursor: pointer;
      transition: all 180ms ease-out;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      font-size: 0.85rem;
    }
    .tab.active {
      border-color: var(--accent);
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.35), rgba(15, 23, 42, 1));
      color: var(--text);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .panel {
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.96));
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.15);
      backdrop-filter: blur(18px);
      margin-bottom: 24px;
    }
    .panel-title {
      font-size: 0.85rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: #9ca3af;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .panel-title-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: radial-gradient(circle, #22c55e, #15803d);
      box-shadow: 0 0 16px rgba(34, 197, 94, 0.8);
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    th {
      font-size: 0.75rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--muted);
    }
    td {
      font-size: 0.9rem;
    }
    .status-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }
    .status-reported { background: rgba(239, 68, 68, 0.2); color: #fca5a5; border: 1px solid rgba(239, 68, 68, 0.4); }
    .status-validated { background: rgba(245, 158, 11, 0.2); color: #fcd34d; border: 1px solid rgba(245, 158, 11, 0.4); }
    .status-in_transformation { background: rgba(59, 130, 246, 0.2); color: #93c5fd; border: 1px solid rgba(59, 130, 246, 0.4); }
    .status-resolved { background: rgba(34, 197, 94, 0.2); color: #86efac; border: 1px solid rgba(34, 197, 94, 0.4); }
    .status-beyond_nullpoint { background: rgba(34, 197, 94, 0.3); color: #86efac; border: 1px solid rgba(34, 197, 94, 0.5); }
    .amount-negative {
      color: var(--danger);
      font-weight: 600;
    }
    .amount-positive {
      color: var(--success);
      font-weight: 600;
    }
    .btn {
      padding: 10px 20px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      color: #0b1120;
      font-weight: 600;
      cursor: pointer;
      transition: transform 180ms ease-out, box-shadow 180ms ease-out;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 0.85rem;
    }
    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 42px rgba(30, 64, 175, 0.7);
    }
    .search-box {
      position: relative;
      margin-bottom: 16px;
    }
    .search-box input {
      width: 100%;
      padding: 12px 16px 12px 40px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.96));
      color: var(--text);
      font-size: 0.9rem;
      outline: none;
    }
    .search-box input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.35);
    }
    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
    }
  </style>

  <link rel="stylesheet" href="../css/teladia-complete-design-system.css">
  <link rel="stylesheet" href="./css/da-vinci-xxxxxl-enterprise-standard.css">
</head>
<body>
  <div class="glow-orbit"></div>
  <div class="app-shell">
    <header>
      <h1>
        TELBANK Negative Assets Pool
        <span class="badge">IBM XXXL Standard</span>
      </h1>
      <div class="subtitle">
        Minus-Asset-Universum: Transformation von negativen Assets in positive, unternehmerische Handlungen.
        Nullpunkt-Konzept: "Aus dem Dunkeln ins Licht"
      </div>
    </header>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Total Negative Assets</div>
        <div class="stat-value" id="statTotalAssets">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Total Exposure</div>
        <div class="stat-value amount-negative" id="statTotalExposure">â‚¬0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">In Transformation</div>
        <div class="stat-value" id="statInTransformation">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Beyond Nullpoint</div>
        <div class="stat-value amount-positive" id="statBeyondNullpoint">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Participating Banks</div>
        <div class="stat-value" id="statBanks">0</div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="assets">Negative Assets</button>
      <button class="tab" data-tab="transformations">Transformations</button>
      <button class="tab" data-tab="banks">Participating Banks</button>
      <button class="tab" data-tab="ledger">Ledger</button>
      <button class="tab" data-tab="import">Import</button>
    </div>

    <div id="tabAssets" class="tab-content active">
      <div class="panel">
        <div class="panel-title">
          <span class="panel-title-dot"></span>
          Negative Assets Pool
        </div>
        <div class="search-box">
          <span class="search-icon">ðŸ”</span>
          <input type="text" id="searchAssets" placeholder="Suche nach Bank, Asset, Currency..." />
        </div>
        <table>
          <thead>
            <tr>
              <th>Asset ID</th>
              <th>Bank</th>
              <th>Asset Class</th>
              <th>Currency</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Nullpoint</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="assetsTableBody">
            <tr><td colspan="8" style="text-align:center;color:var(--muted);padding:32px;">Lade Negative Assets...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="tabTransformations" class="tab-content">
      <div class="panel">
        <div class="panel-title">
          <span class="panel-title-dot"></span>
          Transformation Actions
        </div>
        <table>
          <thead>
            <tr>
              <th>Transform ID</th>
              <th>Asset ID</th>
              <th>Action Type</th>
              <th>Effect Amount</th>
              <th>State</th>
              <th>Executed</th>
            </tr>
          </thead>
          <tbody id="transformationsTableBody">
            <tr><td colspan="6" style="text-align:center;color:var(--muted);padding:32px;">Lade Transformations...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="tabBanks" class="tab-content">
      <div class="panel">
        <div class="panel-title">
          <span class="panel-title-dot"></span>
          Participating Banks
        </div>
        <table>
          <thead>
            <tr>
              <th>Bank ID</th>
              <th>Legal Name</th>
              <th>Country</th>
              <th>BIC/SWIFT</th>
              <th>Contact Email</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="banksTableBody">
            <tr><td colspan="6" style="text-align:center;color:var(--muted);padding:32px;">Lade Banks...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="tabLedger" class="tab-content">
      <div class="panel">
        <div class="panel-title">
          <span class="panel-title-dot"></span>
          TELBANK Ledger
        </div>
        <table>
          <thead>
            <tr>
              <th>Entry ID</th>
              <th>Type</th>
              <th>Currency</th>
              <th>Amount</th>
              <th>Description</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="ledgerTableBody">
            <tr><td colspan="6" style="text-align:center;color:var(--muted);padding:32px;">Lade Ledger...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="tabImport" class="tab-content">
      <div class="panel">
        <div class="panel-title">
          <span class="panel-title-dot"></span>
          Import Batches
        </div>
        <table>
          <thead>
            <tr>
              <th>Batch ID</th>
              <th>Source Type</th>
              <th>Status</th>
              <th>Lines</th>
              <th>Processed</th>
              <th>Failed</th>
              <th>Received</th>
            </tr>
          </thead>
          <tbody id="importTableBody">
            <tr><td colspan="7" style="text-align:center;color:var(--muted);padding:32px;">Lade Imports...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script src="../js/telbank-api-real.js"></script>
  <script type="module">
    // Tab-Switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        const tabId = 'tab' + tab.dataset.tab.charAt(0).toUpperCase() + tab.dataset.tab.slice(1);
        document.getElementById(tabId)?.classList.add('active');
        loadTabData(tab.dataset.tab);
      });
    });

    async function loadTabData(tab) {
      switch(tab) {
        case 'assets':
          await loadNegativeAssets();
          break;
        case 'transformations':
          await loadTransformations();
          break;
        case 'banks':
          await loadBanks();
          break;
        case 'ledger':
          await loadLedger();
          break;
        case 'import':
          await loadImports();
          break;
      }
    }

    async function loadNegativeAssets(apiBase) {
      const tbody = document.getElementById('assetsTableBody');
      const api = new TelbankRealAPI();
      
      try {
        tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;color:var(--muted);padding:32px;">Lade echte Daten...</td></tr>';
        
        const data = await api.getRealNegativeAssets();
        const assets = Array.isArray(data) ? data : (data.results || []);
        
        if (assets.length === 0) {
          tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;color:var(--muted);padding:32px;">Keine Negative Assets gefunden.</td></tr>';
          return;
        }
        
        tbody.innerHTML = assets.map(asset => `
          <tr>
            <td><code>${asset.neg_asset_id ? asset.neg_asset_id.slice(0, 8) + '...' : 'N/A'}</code></td>
            <td>${asset.bank_name || 'N/A'}</td>
            <td>${asset.asset_class || 'N/A'}</td>
            <td>${asset.currency_code || 'N/A'}</td>
            <td class="amount-negative">${api.formatCurrency(asset.nominal_amount || 0, asset.currency_code || 'EUR')}</td>
            <td><span class="status-badge status-${asset.status || 'reported'}">${asset.status || 'reported'}</span></td>
            <td>${asset.nullpoint_status || 'N/A'}</td>
            <td>${asset.event_date ? api.formatDate(asset.event_date) : 'N/A'}</td>
          </tr>
        `).join('');
        updateStats(assets);
      } catch (err) {
        console.error('Failed to load negative assets:', err);
        tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;color:var(--danger);padding:32px;">Fehler beim Laden: ${err.message}</td></tr>`;
      }
    }

    async function loadTransformations(apiBase) {
      const tbody = document.getElementById('transformationsTableBody');
      const api = new TelbankRealAPI();
      
      try {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:32px;">Lade echte Daten...</td></tr>';
        const data = await api.getRealTransformations();
        const transformations = Array.isArray(data) ? data : [];
        
        if (transformations.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:32px;">Keine Transformationen gefunden.</td></tr>';
          return;
        }
        
        tbody.innerHTML = transformations.map(t => `
          <tr>
            <td><code>${t.transform_id ? t.transform_id.slice(0, 8) + '...' : 'N/A'}</code></td>
            <td><code>${t.neg_asset_id ? t.neg_asset_id.slice(0, 8) + '...' : 'N/A'}</code></td>
            <td>${t.action_type || 'N/A'}</td>
            <td>${t.effect_amount ? api.formatCurrency(t.effect_amount, t.currency_code || 'EUR') : 'N/A'}</td>
            <td><span class="status-badge status-${t.result_state || 'planned'}">${t.result_state || 'planned'}</span></td>
            <td>${t.executed_at ? api.formatDate(t.executed_at) : 'N/A'}</td>
          </tr>
        `).join('');
      } catch (err) {
        console.error('Failed to load transformations:', err);
        tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;color:var(--danger);padding:32px;">Fehler: ${err.message}</td></tr>`;
      }
    }

    async function loadBanks(apiBase) {
      const tbody = document.getElementById('banksTableBody');
      const api = new TelbankRealAPI();
      
      try {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:32px;">Lade echte Daten...</td></tr>';
        const data = await api.getRealBanks({ is_active: true });
        const banks = Array.isArray(data) ? data : [];
        
        if (banks.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:32px;">Keine Banken gefunden.</td></tr>';
          return;
        }
        
        tbody.innerHTML = banks.map(b => `
          <tr>
            <td><code>${b.bank_id ? b.bank_id.slice(0, 8) + '...' : 'N/A'}</code></td>
            <td>${b.legal_name || 'N/A'}</td>
            <td>${b.country_code || 'N/A'}</td>
            <td>${b.bic_swift || 'N/A'}</td>
            <td>${b.contact_email || 'N/A'}</td>
            <td><span class="status-badge status-${b.onboarding_status || 'pending'}">${b.onboarding_status || 'pending'}</span></td>
          </tr>
        `).join('');
      } catch (err) {
        console.error('Failed to load banks:', err);
        tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;color:var(--danger);padding:32px;">Fehler: ${err.message}</td></tr>`;
      }
    }

    async function loadLedger(apiBase) {
      const tbody = document.getElementById('ledgerTableBody');
      // Ledger API would need to be implemented
      tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:var(--muted);padding:32px;">Ledger API wird implementiert...</td></tr>';
    }

    async function loadImports(apiBase) {
      const tbody = document.getElementById('importTableBody');
      // Import API would need to be implemented
      tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:var(--muted);padding:32px;">Import API wird implementiert...</td></tr>';
    }

    function updateStats(assets) {
      const api = new TelbankRealAPI();
      document.getElementById('statTotalAssets').textContent = assets.length;
      const total = assets.reduce((sum, a) => sum + (a.nominal_amount || 0), 0);
      document.getElementById('statTotalExposure').textContent = api.formatCurrency(total, 'EUR');
      document.getElementById('statInTransformation').textContent = assets.filter(a => a.status === 'in_transformation').length;
      document.getElementById('statBeyondNullpoint').textContent = assets.filter(a => a.nullpoint_status === 'beyond_nullpoint').length;
      
      // Load real banks count
      api.getRealBanks({ is_active: true }).then(banks => {
        const bankCount = Array.isArray(banks) ? banks.length : 0;
        document.getElementById('statBanks').textContent = bankCount;
      }).catch(err => {
        console.error('Failed to load banks count:', err);
      });
    }

    // Initial load
    loadTabData('assets');
  </script>
  <script src="./css/da-vinci-enterprise-standard-init.js"></script>
</body>
</html>


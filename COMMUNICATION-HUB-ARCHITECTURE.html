<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>COMMUNICATION-HUB-ARCHITECTURE</title>
<style>
body { font-family: system-ui; max-width: 800px; margin: 0 auto; padding: 20px; }
pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
code { background: #f5f5f5; padding: 2px 4px; border-radius: 3px; }
</style>
</head>
<body>
<h1>Communication Hub â€“ ArchitekturÃ¼bersicht</h1>

> Ziel: Autopilotâ€‘Kommunikation fÃ¼r Manifestâ€‘Offlineâ€‘Portal + Onlineâ€‘Portal  
> (â€Ich bin onlineâ€œ â†’ PrÃ¤senz, Matching, Liveâ€‘Raum, Signaling, APIs â€“ alles automatisch)

---

<h2>1. Systemkomponenten im Ãœberblick</h2>

<strong>Frontend</strong>
- `manifest-forum.html` (Offlineâ€‘Manifest)
  - Speichert BeitrÃ¤ge lokal (`localStorage`).
  - Kennt `MOT_ACCESS_TOKEN` bzw. Token/Lokale IdentitÃ¤t.
  - Ã–ffnet das Onlineâ€‘Portal mit HMACâ€‘gesichertem Token in der URL (`#mot=...&ts=...&sig=...`).
- `manifest-portal.html` (Onlineâ€‘Portal)
  - Liest Token aus `location.hash` / optional `localStorage.mot_token`.
  - Autoâ€‘Verifikation + Autoâ€‘Presence + Autoâ€‘Matching.
  - UI fÃ¼r:
    - JSONâ€‘Import / APIâ€‘URL
    - Signalingâ€‘URL / Presets
    - Noâ€‘Code Raumâ€‘JSONâ€‘Builder
    - Autoâ€‘Connect (`pairCodeInput`, `connectStatus`, `liveRoom`).

<strong>Backend</strong>
- `presence-api-server.js` (Node/Express Presenceâ€‘API)
  - `/verify` â€“ IdentitÃ¤t klÃ¤ren und `thinker_id` ableiten.
  - `/heartbeat` â€“ Anwesenheit melden (Status + `last_seen` + `pair_code`).
  - `/match` â€“ passende Partner/Gruppe mit gleichem `pair_code` finden, `room_id` vergeben.
  - Optional spÃ¤ter: Anschluss an DB (Supabase/Firebase/Postgres).
- (zukÃ¼nftig) Signalingâ€‘Server (WSS)
  - Verwaltet WebSocketâ€‘Verbindungen/Signaling fÃ¼r Text, WebRTC, Dateiâ€‘Signalisierung.
  - RÃ¤ume werden anhand von `room_id` organisiert.
- (zukÃ¼nftig) APIâ€‘Katalogâ€‘Service
  - Liefert Liste verfÃ¼gbarer APIs (Verifikation, Dokumente, KI, etc.).
  - Bietet Metadaten: `base_url`, Authâ€‘Typ, Beispielâ€‘Payload.

---

<h2>2. Datenmodelle</h2>

<h3>2.1 Presence</h3>

Inâ€‘Memory (spÃ¤ter DB):

```json
{
  "thinker_id": "thinker-abc123",
  "token": "mot-shared-token-v1",
  "pair_code": "projekt_alpha",
  "status": "online",
  "last_seen": 1732350000,
  "room_id": "room-projekt_alpha-xyz"
}
```

Felder:
- <strong>thinker_id</strong>: stabile IdentitÃ¤t eines Users (aus Token abgeleitet oder explizit).
- <strong>token</strong>: Rohâ€‘Token (z.B. `MOT_ACCESS_TOKEN`).
- <strong>pair_code</strong>: frei gewÃ¤hltes Stichwort (z.B. `projekt_alpha`, `familie`).
- <strong>status</strong>: `"online"` / `"offline"` (spÃ¤ter optional `idle`).
- <strong>last_seen</strong>: Zeitstempel des letzten Heartbeats.
- <strong>room_id</strong>: zugewiesener Raum (wenn bereits verbunden).

<h3>2.2 Room (Konfiguration)</h3>

```json
{
  "type": "video",            // text | video | file | contract
  "roomId": "post-123",
  "permissions": {
    "read": true,
    "send": true,
    "sign": false,
    "upload": true
  }
}
```

In der Portalâ€‘UI werden diese Objekte Ã¼ber das Noâ€‘Codeâ€‘Formular erzeugt und im JSONâ€‘Format (z.B. `{ "rooms": [...] }`) an das Backend/Signaling weitergegeben.

<h3>2.3 APIâ€‘Katalog (Entwurf)</h3>

```json
{
  "id": "doc-verify-x",
  "name": "Dokument-Verifikation X",
  "category": "verification",
  "base_url": "https://api.example.com/v1/documents",
  "auth_type": "bearer",
  "doc_url": "https://docs.example.com",
  "example_payload": { "file_id": "123" }
}
```

---

<h2>3. Hauptâ€‘Flows (Autopilot)</h2>

<h3>3.1 â€Ich gehe onlineâ€œ â€“ vom Offlineâ€‘Manifest ins Portal</h3>

1. User Ã¶ffnet `manifest-forum.html` (lokal/offline).
2. Manifest kennt bzw. erzeugt ein Token (`MOT_ACCESS_TOKEN` / lokales Token).
3. Beim Klick â€Portal Ã¶ffnen (verifiziert)â€œ:
   - Manifest erzeugt HMACâ€‘Signatur: `sig = HMAC(token, token + "." + ts)`.
   - Ã–ffnet `manifest-portal.html#mot=<token>&ts=<timestamp>&sig=<sig>`.

Auf Portalseite:
1. `tryAutoVerify()` prÃ¼ft Signatur, aktiviert UI fÃ¼r verifizierte Nutzer.
2. `autoConnectFromToken()`:
   - Liest Token aus Hash oder `localStorage.mot_token`.
   - Ruft `/verify` auf â†’ erhÃ¤lt `{ thinker_id, pair_code? }`.
   - Startet Heartbeat + Matching.

<h3>3.2 Presence & Matching</h3>

<strong>Heartbeat</strong> (`startPresenceHeartbeat` im Portal):
- Alle 25s:
  - `POST /heartbeat { thinker_id, pair_code, status:"online" }`.
- Bei Seitenverlassen optional:
  - `status:"offline"` senden.

<strong>Matching</strong> (`startMatchLoop` im Portal):
- Alle 5s:
  - `POST /match { thinker_id, pair_code }`.
  - Backend:
    - Sucht alle Thinker mit `pair_code`, `status:"online"`, `last_seen` â‰¤ 60s.
    - Wenn â‰¥ 2:
      - Vergibt/teilt `room_id`.
      - Antwort: `{ room_id: "room-..." }`.
- Portal:
  - Bei neuer `room_id`:
    - Zeigt Status an (`connectStatus`).
    - Ã–ffnet `liveRoom` + Info (`liveRoomInfo`).
    - Ãœbergibt `room_id` an Signalingâ€‘Layer (spÃ¤ter).

<h3>3.3 Signaling / Liveâ€‘Verbindung (spÃ¤terer Ausbau)</h3>

1. Portal erhÃ¤lt `room_id`.
2. Portal ruft `joinRoom(room_id, thinker_id)` am Signalingâ€‘Server auf:
   - z.B. via WebSocket Nachricht `{ type:"join", room_id, thinker_id }`.
3. Signalingâ€‘Server:
   - HÃ¤lt eine Liste der aktiven Connections je `room_id`.
   - Vermittelt:
     - Textnachrichten (`chat`),
     - WebRTC Signaling (Offer/Answer/ICE),
     - Dateiâ€‘Transferâ€‘Signalisierung.
4. Backendâ€‘Orchestrator kann anhand der Roomâ€‘Definition (siehe 2.2) entscheiden:
   - Wer darf senden?
   - Wer darf unterschreiben?
   - Wer darf Dateien hochladen?

---

<h2>4. Zustandsmodell (States)</h2>

FÃ¼r jeden Raum:

- <strong>waiting</strong>  
  Mindestens 1 Thinker mit `pair_code` online, aber noch kein Match.

- <strong>joining</strong>  
  Zweiter (oder weitere) Thinker kommt dazu, `room_id` wird vergeben.

- <strong>active</strong>  
  Raum ist aktiv, mindestens zwei Teilnehmer verbunden; Signaling lÃ¤uft.

- <strong>closing</strong>  
  Raum wird geschlossen (z.B. weil alle bis auf einen gegangen sind oder Timeout).

- <strong>closed</strong>  
  Kein weiterer Traffic; `room_id` kann archiviert/vergessen werden.

Im ersten Schritt wird dieses Stateâ€‘Modell implizit Ã¼ber `presence` + Zeitfenster abgebildet. SpÃ¤ter kann ein eigenes `rooms`â€‘Modell eingefÃ¼hrt werden, das diese States explizit speichert.

---

<h2>5. Roadmapâ€‘Punkte, die auf dieser Architektur aufbauen</h2>

1. <strong>DBâ€‘Anschluss</strong>  
   - PrÃ¤senz aus dem Inâ€‘Memoryâ€‘Store in eine echte Datenbank (Supabase/Firebase/Postgres) Ã¼berfÃ¼hren.

2. <strong>Signalingâ€‘Layer ergÃ¤nzen</strong>  
   - Einheitliche Schnittstelle `joinRoom`, `sendMessage`, `onMessage` in einem separaten Modul (`signal-server.js`).

3. <strong>APIâ€‘Katalogâ€‘Service</strong>  
   - Endpunkt `GET /api/catalog/apis`, Integration in Portalâ€‘UI (Dropdown + Autoâ€‘Konfiguration).

4. <strong>Gruppenâ€‘Matching & Rollen</strong>  
   - Mehr als 2 Teilnehmer, Rollen (Host, Gast, Observer) in Presence/Rooms modellieren.

5. <strong>Monitoring & Fehlerâ€‘Autopilot</strong>  
   - Healthâ€‘Checks, Logs, Monitoringâ€‘Dashboard, damit â€Autopilotâ€œ bei Fehlern kontrolliert eingreift (z.B. Reconnectâ€‘Strategien).

Dieses Dokument dient als Referenz dafÃ¼r, wie Manifestâ€‘Offlineâ€‘Portal, Onlineâ€‘Portal, Presenceâ€‘API, Signaling und APIâ€‘Katalog zu einem Communication Hub zusammenwachsen, der fÃ¼r Endnutzer wie ein Autopilot funktioniert: â€Ich gehe onlineâ€œ genÃ¼gt â€“ der Rest lÃ¤uft automatisch.
<p>---

<h2>ğŸ¢ Unternehmens-Branding & OCR</h2>

<strong>TogetherSystems</strong> | <strong>T,.&T,,.&T,,,.</strong> | <strong>TTT Enterprise Universe</strong>

| Information | Link |
|------------|------|
| <strong>Initiator</strong> | <a href="https://orcid.org/0009-0003-1328-2430">Raymond Demitrio Tel</a> |
| <strong>ORCID</strong> | <a href="https://orcid.org/0009-0003-1328-2430">0009-0003-1328-2430</a> |
| <strong>Website</strong> | <a href="https://tel1.nl">tel1.nl</a> |
| <strong>WhatsApp</strong> | <a href="https://wa.me/31613803782">+31 613 803 782</a> |
| <strong>GitHub</strong> | <a href="https://github.com/myopenai/togethersystems">myopenai/togethersystems</a> |
| <strong>Businessplan</strong> | <a href="https://github.com/T-T-T-Sysytems-T-T-T-Systems-com-T-T/.github/blob/main/TGPA_Businessplan_DE.pdf">TGPA Businessplan DE.pdf</a> |

<strong>Branding:</strong> T,.&T,,.&T,,,.(C)(R)TEL1.NL - TTT,. -

<strong>IBM+++ MCP MCP MCP Standard</strong> | <strong>Industrial Business Machine</strong> | <strong>Industrial Fabrication Software</strong>

---</p>
</body>
</html>